<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="W.E.B. Du&nbsp;Bois">
<meta name="dcterms.date" content="1934-02-01">

<title>The N.A.A.C.P. and Race Segregation – Dare You Fight</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta name="citation_title" content="The N.A.A.C.P. and Race Segregation">
<meta name="citation_author" content="W.E.B. Du&nbsp;Bois">
<meta name="citation_publication_date" content="1934-02-01">
<meta name="citation_cover_date" content="1934-02-01">
<meta name="citation_year" content="1934">
<meta name="citation_online_date" content="1934-02-01">
<meta name="citation_fulltext_html_url" content="https://www.dareyoufight.org/Volumes/41/02/naacp_and_race_segregation.html">
<meta name="citation_issue" content="2">
<meta name="citation_volume" content="41">
<meta name="citation_language" content="en">
<meta name="citation_firstpage" content="52">
<meta name="citation_lastpage" content="53">
<meta name="citation_journal_title" content="The&nbsp;Crisis">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../Images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Dare You Fight</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../listing.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../backround.html"> 
<span class="menu-text">Background</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="../../../map.html">
 <span class="dropdown-text">Article Map</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../covers.html">
 <span class="dropdown-text">Covers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../credits.html">
 <span class="dropdown-text">Credits</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The N.A.A.C.P. and Race Segregation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>W.E.B. Du&nbsp;Bois </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 1, 1934</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>There is a good deal of misapprehension as to the historic attitude of the National Association for the Advancement of Colored People and race segregation. As a matter of fact, the Association, while it has from time to time discussed the larger aspects of this matter, has taken no general stand and adopted no general philosophy. Of course its action, and often very effective action, has been in specific cases of segregation where the call for a definite stand was clear and decided. For instance, in the preliminary National Negro Convention which met in New York May 31st and June 1st, 1909, segregation was only mentioned in a protest against Jim-Crow car laws and that because of an amendment by William M. Trotter. In the First Annual Report, January 1, 1911, the Association evolved a statement of its purpose, which said that “it seeks to uplift the colored men and women of this country by securing to them the full enjoyment of their rights as citizens, justice in all courts, and equality of opportunity everywhere.” Later, this general statement was epitomized in the well-known declaration: “It conceives its mission to be the completion of the work which the great Emancipator began. It proposes to make a group of ten million Americans free from the lingering shackles of past slavery, physically free from peonage, mentally free from ignorance, politically free from disfranchisement, and socially free from insult.” This phrase which I first wrote myself for the Annual Report of 1915 still expresses pregnantly the object of the N.A.A.C.P. and it has my own entire adherence.</p>
<p>It will be noted, however, that here again segregation comes in only by implication. Specifically, it was first spoken of in the Second Report of the Association, January 1, 1912, when the attempt to destroy the property of Negroes in Kansas City because they had moved into a white section was taken up. This began our fight on a specific phase of segregation, namely, the attempt to establish a Negro ghetto by force of law. This phase of segregation we fought vigorously for years and often achieved notable victories in the highest courts of the land.</p>
<p>But it will be noted here that the N.A.A.C.P. expressed no opinion as to whether it might not be a feasible and advisable thing for colored people to establish their own residential sections, or their own towns; and certainly there was nothing expressed or implied that Negroes should not organize for promoting their own interests in industry, literature or art. Manifestly, here was opportunity for considerable difference of opinion, but the matter never was thoroughly threshed out.</p>
<p>The Association moved on to other matters of color discrimination: the “Full Crew” bills which led to dismissal of so many Negro railway employees; the “Jim-Crow” car laws on railway trains and street cars; the segregation in government departments. In all these matters, the stand of the Association was clear and unequivocal: it held that it was a gross injustice to make special rules which discriminated against the color of employees or patrons.</p>
<p>In the Sixth Annual Report issued in March, 1916, the seven lines of endeavor of the Association included change of unfair laws, better administration of present laws, justice in the courts, stoppage of public slander, the investigation of facts, the encouragement of distinguished work by Negroes, and organizations.</p>
<p>Very soon, however, there came up a more complex question and that was the matter of Negro schools. The Association had avoided from the beginning any thoroughgoing pronouncement on this matter. In the resolutions of 1909, the conference asked: “Equal educational opportunities for all and in all the states, and that public school expenditure be the same for the Negro and white child.” This of course did not touch the real problem of separate schools. Very soon, however, definite problems were presented to the Association: the exclusion of colored girls from the Oberlin dormitories in 1919; the discrimination in the School of Education at the University of Pennsylvania; and the Cincinnati fight against establishing a separate school for colored children, brought the matter squarely to the front. Later, further cases came; the Brooklyn Girls’ High School, the matter of a colored High School in Indianapolis, and the celebrated Gary case.</p>
<p>Gradually, in these cases the attitude of the Association crystalized. It declared that further extension of segregated schools for particular races and especially for Negroes was unwise and dangerous, and the Association undertook in all possible cases to oppose such further segregation. It did not, however, for a moment feel called upon to attack the separate schools where most colored children are educated throughout the United States and it refrained from this not because it approved of separate schools, but because it was faced by a fact and not a theory. It saw no sense in tilting against windmills.</p>
<p>The case at Cheyney was a variation; here was an old and separate private school which became in effect though not in law a separate public normal school; and in the city of Philadelphia a partial system of elementary Negro schools was developed with no definite action on the part of the N.A.A.C.P.</p>
<p>It will be seen that in all these cases the Association was attacking specific instances and not attempting to lay down any general rule as to how far the advancement of the colored race in the United States was going to involve separate racial action and segregated organization of Negroes for certain ends.</p>
<p>To be sure, the overwhelming and underlying thought of the N.A.A.C.P. has always been: that any discrimination based simply on race is fundamentally wrong, and that consequently purely racial organizations must have strong justification to be admissable. On the other hand, they faced certain unfortunate but undeniable facts. For instance, War came. The Negro was being drafted. No Negro officers were being commissioned. The N.A.A.C.P. asked for the admission of Negroes to the officers’ schools. This was denied. There was only one further thing to do and that was to ask for a school for Negro officers. There arose a bitter protest among many Negroes against this movement. Nevertheless, the argument for it was absolutely unanswerable, and Joel E. Spingarn, Chairman of the Board, supported by the students of Howard University, launched a movement which resulted in the commissioning of seven hundred Negro officers if the A. E. F. In all the British Dominions, with their hundreds of millions of colored folk, there was not a single officer of known Negro blood. The American Negro scored a tremendous triumph against the Color Line by their admitted and open policy of segregation. This did not mean that Mr.&nbsp;Spingarn or any of the members of the N.A.A.C.P. thought it right that there should be a separate Negro camp, but they thought a separate Negro camp and Negro officers was infinitely better than no camp and no Negro officers and that was the only practical choice that lay before them.</p>
<p>Similarly, in the question of the Negro vote, the N.A.A.C.P. began in 1920 an attempt to organize the Negro vote and cast it in opposition to open enemies of the Negro race who were running for office. This was without doubt a species of segregation. It was appealing to voters on the grounds of race, and it brought for that reason considerable opposition. Nevertheless, it could be defended on the ground that the election of enemies of the Negro race was not only a blow to that race but to the white race and to all civilization. And while our attitude, even in the Parker case, has been criticized, it has on the whole found abundant justification.</p>
<p>The final problem in segregation presented to us was that of the Harlem Hospital. Here was a hospital in the center of a great Negro population which for years did not have and would not admit a single Negro physician to its staff. Finally, by agitation and by political power, Negroes obtained representation on the staff in considerable numbers and membership on the Board of Control. It was a great triumph. But it was accompanied by reaction on the part of whites and some Negroes who had opposed this movement, and an attempt to change the status of the hospital so that it would become a segregated Negro hospital, and so that presumably the other hospitals of the city would continue to exclude Negroes from their staffs. With this arose a movement to establish Negro hospitals throughout the United States.</p>
<p>Here was an exceedingly difficult problem. On the one hand, there is no doubt of the need of the Negro population for wider and better hospitalization; and of the demand or the part of Negro physicians for opportunities of hospital practice. This was illustrated by the celebrated Tuskegee hospital where nearly all the Negro veterans are segregated but where an efficient Negro staff has been installed. Perhaps nothing illustrates better than this the contradiction and paradox of the problem of race segregation in the United States, and the problem which the N.A.A.C.P. faced and still faces.</p>
<p>The N.A.A.C.P. opposed the initial establishment of the hospital at Tuskegee although it is doubtful if it would have opposed such a hospital in the North. On the other hand, once established, we fought to defend the Tuskegee hospital and give it widest opportunity.</p>
<p>In other words, the N.A.A.C.P. has never officially opposed separate Negro organizations—such as churches, schools and business and cultural organizations. It has never denied the recurrent necessity of united separate action on the part of Negroes for self-defense and self-development; but it has insistently and continually pointed out that such action is in any case a necessary evil involving often a recognition from within of the very color line which we are fighting without. That race pride and race loyalty, Negro ideals and Negro unity, have a place and function today, the N.A.A.C.P. never has denied and never can deny.</p>
<p>But all this simply touches the whole question of racial organization and initiative. No matter what we may wish or say, the vast majority of the Negroes in the United States are born in colored homes, educated in separate colored schools, attend separate colored churches, marry colored mates, and find their amusement in colored Y.M.C.A.’s and Y.W.C.A.’s. Even in their economic life, they are gradually being forced out of the place in industry which they occupied in the white world and are being compelled to seek their living among themselves. Here is segregation with a vengeance, and its problems must be met and its course guided. It would be idiotic simply to sit on the side lines and yell: “No segregation” in an increasingly segregated world.</p>
<p>On the other hand, the danger of easily and eagerly yielding to suggested racial segregation without reason or pressure stares us ever in the face. We segregate ourselves. We herd together. We do things such as this clipping from the Atlanta Constitution indicates:</p>
<blockquote class="blockquote">
<p>A lecture on the raising of Lazarus from the dead will be delivered at the city auditorium on Friday night. The Big Bethel choir will sing and the Graham Jackson band will give additional music. Space has been set aside for white people.</p>
</blockquote>
<p>The “Jim Crow” galleries of Southern moving picture houses are filled with some of the best Negro citizens. Separate schools and other institutions have been asked by Negroes in the north when the whites had made no real demand.</p>
<p>Such are the flat and undeniable facts. What are we going to do about them? We can neither yell them down nor make them disappear by resolutions. We must think and act. It is this problem which The&nbsp;Crisis dgsires to discuss during the present year in all its phases and with ample and fair representation to all shades of opinion.</p>
<!-- Similar articles start here -->
<div class="clear-wrap">

</div>
<section id="related-articles" class="level4">
<h4 class="anchored" data-anchor-id="related-articles">Related Articles</h4>
<ul>
<li><a href="../../../Volumes/22/01/inter-racial_comity.html">Inter-Racial Comity (1922)</a></li>
<li><a href="../../../Volumes/20/01/white_coworkers.html">White Co-Workers (1920)</a></li>
<li><a href="../../../Volumes/36/05/negro_citizen.html">The Negro Citizen (1929)</a></li>
<li><a href="../../../Volumes/41/04/segregation_in_the_north.html">Segregation in the North (1934)</a></li>
<li><a href="../../../Volumes/28/03/unity.html">Unity (1924)</a></li>
</ul>
<!-- Similar articles end here -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-du_bois1934" class="csl-entry quarto-appendix-citeas" role="listitem">
Du&nbsp;Bois, W.E.B. 1934. <span>“The N.A.A.C.P. And Race
Segregation.”</span> <em>The&nbsp;Crisis</em> 41 (2): 52–53. <a href="https://www.dareyoufight.org/Volumes/41/02/naacp_and_race_segregation.html">https://www.dareyoufight.org/Volumes/41/02/naacp_and_race_segregation.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.dareyoufight\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>