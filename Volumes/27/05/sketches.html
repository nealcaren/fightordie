<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="W.E.B. Du&nbsp;Bois">
<meta name="dcterms.date" content="1924-03-01">

<title>Sketches from Abroad – Dare You Fight</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta name="citation_title" content="Sketches from Abroad">
<meta name="citation_author" content="W.E.B. Du&nbsp;Bois">
<meta name="citation_publication_date" content="1924-03-01">
<meta name="citation_cover_date" content="1924-03-01">
<meta name="citation_year" content="1924">
<meta name="citation_online_date" content="1924-03-01">
<meta name="citation_fulltext_html_url" content="https://www.dareyoufight.org/Volumes/27/05/sketches.html">
<meta name="citation_issue" content="5">
<meta name="citation_volume" content="27">
<meta name="citation_language" content="en">
<meta name="citation_firstpage" content="203">
<meta name="citation_lastpage" content="295">
<meta name="citation_journal_title" content="The&nbsp;Crisis">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../Images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Dare You Fight</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../listing.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../backround.html"> 
<span class="menu-text">Background</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="../../../map.html">
 <span class="dropdown-text">Article Map</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../covers.html">
 <span class="dropdown-text">Covers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../credits.html">
 <span class="dropdown-text">Credits</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sketches from Abroad</h1>
<p class="subtitle lead">Le Grand Voyage</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>W.E.B. Du&nbsp;Bois </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 1, 1924</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>I have taken many journeys but this is the greatest. I have seen all the states of the American Empire and something of the Western Indies. I have seen England and France many times—all parts of Germany and something of Austria, Switzerland and Italy.</p>
<p>But all this (save Armenia) was white, kindly on the whole—intensely interesting, but painfully white. Today I am drifting toward darkness. I have seen the skin grow sallow and the eyes darken and hair quiver, in southern France, in Spain, in Portugal, in the Canary Isles; and now I set my face toward Africa—the Eternal World of Black Folk.</p>
<hr>
<p>There is a snow capped peak that sits in the seas. With grey mantilla about its silvered hair Teneriffe frowns on the Canaries and the Canaries smile on the waters, the waters love Africa and Africa frowns on God.</p>
<p>A long way—a long, long way have I come to this gate of the darkest world.</p>
<hr>
<p>I was in England at the beginning of that singular election campaign which astonished Europe and in the end revealed the bankruptcy of traditional England. It was a cold, wet England with here and there the white sunshine of promise. It was an England on the farewell evening of the Imperial Conference. No black men were there, but brown men sat and spoke and were listened to. England fears India. Only Smuts replied. Smuts, that curious, provincial mind—German in sympathy, suspicious of France and its black armies, liberal toward all white folk but hating “niggers” and fearing East Indians. He is today the greatest leader in the British Empire. In this atmosphere Pan Africa sat and whispered. But some few listened.</p>
<hr>
<p>I was in France when the first signs came that the hegemony of future mid-European industry, with all its inherent political power, had passed from Germany to France, with England helplessly and jealously watching. The capitalists of the Ruhr, German and French, are agreed. The world will pay. And yet there is one vast beacon of light—France is depending for her hegemony of Europe on Africa. If the rest of Europe wishes to meet her racial bid, they too must make peace—industrial and racial peace—with Africa.</p>
<p>At St.&nbsp;Etienne the most popular man in town—the head of the French and Foreign Club, the chief sportsman, the guest of a hundred hosts, and the welcomed of all business men—is one of us—Hunt, the only American Consul of Negro descent in Europe. The State Department is worried over Hunt. He deserves promotion and they dare not promote him.</p>
<p>Suddenly leaving all this weary world of politics and industry I plunged headlong into fairyland. I am riding down the Rhone. I see the seen and the unseen. The unseen drama of a thousand years and yet nine hundred more. The Allobroges—the Dukes of Burgundy—the Kings of France, shining in the sun and river, the banks rising to mountain heights to westward, the fields and cities, eastward. The colors are pale cream, grey, pale reds, above the blues and greens and browns. The towns are solid, stolid, almost grim, with poplars sternly at attention and vines and tile and wall and tower. Yet there is a kindliness and sweetness in the air—a sense of hearth and home amid factory and swift commerce—the long black steamers, the fruit trees, the pale high hills. The scene stretches into wide plateaus before the dream-far mountains. Then comes a great shoulder of naked rock, a towered town of cream and crimson, sun fields, a mauve and white chateau in trees, the ribbon of river and its poplars; suddenly a gray town with ruined castle on the skies, a river blazing in the sun. From a hill to the right the ghost of the twelfth century stares stonily down upon us. Valence, town of the Gauls, which knew Roman, Visigoth, Lombard and Moor. Upon the right walls that in centuries gone rang with the laughter of the Lady of Poitiers—naughty, beautiful, dead Diana; fair, false and fortunate, are ruins eternal above the waters of the Rhone. To the left a quiet town with one arm clasped lovingly about a hill and the other flung above the river rampart. Opposite the dream of cloudy mountains and vines, yonder a town embroidering a hillside, a solemn cypress here and there and a touch of gay color on roof and door proclaim the coming of the azure coast. Out of earth and mountain leaps on before us another town pale gray and cream, petite and beautiful with light. I see a flying buttress, the towers of a Byzantium church dominating the town and then in applause rock and boulder, rough and hard and grim. On the other side in blue and grayish purple a mighty tower and wall and city with what wonder of past hate and love and war! The ruins of a dead chateau guarding a little golden street; a lonely town of clustered grey crouching on the earth as if a part of it—with wealth of rolling tiles.</p>
<p>Then darkness came down, came down quickly at four and enveloped the widening plane—fell on the tower of Avignon and on the bridge where <em>tout le monde y danse en ronde</em>. On to Arles and Mistral and his song “Have you been to Carcassonne?” But in the soft darkness my soul, free, ranged all Provence and its sweet and unseen beauty.</p>
<hr>
<p>Avignon was shadow and dying day—the shadow of the Palace of the Shadow of the Popes somewhere down between me and the bridge.</p>
<hr>
<p>So in the darkness we came down to where Marseilles beneath the moon shone like a jewel in a jewelled sea.</p>
<p>Oh but it rained in Marseilles! The waters spilled themselves across the city and under and over it all my one day and yet could not quench it, could not quite spare its laughter and charm, its satisfied provincial large-town air. The little “Cannebière” was gay and crowded and wet. The bouillabaisse at What’s-his-name’s (everybody knows him) was expensive and bad, but the great yellow castles that guard the mighty harbor and the little winding sinister streets where folk pass sideways to the seas—they were all there and they are Marseilles.</p>
<section id="ii" class="level2">
<h2 class="anchored" data-anchor-id="ii">II</h2>
<p>I have been to Carcassonne. I have seen the city, sitting like a tale that is told above the earth, a great grey dim and towered thing amid a universe of purple, yellow, brown and green—a far-flung violet heaven on earth, a clustering church-quartered town. On the plain march the great figures of France, while yonder the Pyrenees snow-crowned look on. I have seen the sun die on the ramparts of Carcassonne and as it died the Pyrenees lived. They raised a song that swelled from Marseilles to Barcelona and from earth right up to the blue gold of Heaven. But the earth empurpled died and sank and smoked a thousand candles and cried a thousand wordless tales. The air was like rare wine—the earth beautiful for a lover, the sky fleeced and gilded silver and purple.</p>
<p>The sun falls. Smoke threads up from the nests of tiles. Goats cry, a mist, mysterious, sweeps the purply air and on the ramparts I stand and peer.</p>
<p>As night rose the sky was green and black and gold above the black ramparts fading to white and blue, while afar the grim teeth of the Pyrenees grated on Heaven.</p>
<p>I rose in the night to see what the moon could do to all this. It dripped but shadows on the scene.</p>
<p>Then came the drab cold morning of disillusion. After all this grey rock stained with blood and tears was but an old machine of murder, of desperate defense against desperate men. Its ever winding streets were alleys where hid poverty and filth. About the ramparts without filth still lay and within in inn and guide lurked bold extortion. And yet Carcassonne rose above all triumphant in its crumpled beauty, its sheer and pregnant human appeal—its hoarse voice of seven hundred years, with ghosts of three hundred more. In the tournament range, facing the court of Honor, there are telephone wires.</p>
<p>Sun and cloud, Mediterranean and Pyrenees, yellowing vines and sheep. The vines have leaves like flowers and the purple sea mirrors old castellated towers in yellow and red beneath the black forbidding Pyrenees.</p>
<p>The Pyrenees romp with heaven, play with earth cloud and sun until together they make superb lace work.</p>
<p>Black cedars, two towers of castled keeps, gold trees, grey walls, white roads and vines and vines.</p>
<hr>
<p>Barcelona is a great city thrusting herself outside her swaddling clothes with an effort which rends her body and soul. Great avenues are shouldering aside and threading tiny, winding Old World streets and building new blocks scornful of span with rounded corners and great inner courts. One has a feeling of strident wealth and deep hidden misery, but one cannot tell. A few things I shall remember:—that great cathedral of gloom at Barcelona with the lovely loneliness of its high windows, the fearsome shadow of the grave of its crypt and its singularly beautiful cloisters. The church was a sort of monumental darkness thrown against the gayety of the Rampas.</p>
<p>Then came a serious and savage Spain—bare nests of mountains with yellow towns creeping close to the earth.</p>
<hr>
<p>Always and everywhere there is going on a subtle change. My brown face attracts no attention. I am darker than my neighbors but they are dark. I become, quite to my own surprise, simply a man. I cease to be specially selected for attention either elaborately pleasant or ostentatiously contemptible. Forgetting myself I study others. I feel relieved.</p>
<hr>
<p>Madrid is disappointing. It is artificial. Its ancient soul and body have been cut away and there remain the empty Prado, the wide and ghostly park, the ranging avenues and the empty countryside. It is a city set upon a hill, but the edges of the hill are guarded from the curious. And yet I may be wrong. After all I stayed but a day at Madrid and I saw Goya writhing in oil and Goya was more than Madrid.</p>
<hr>
<p>Lisbon is a lovely city, rising in great swelling of hills, deep creams and crimson above the sea and the calm Tagus. It is a provincial city—a city of one street and the Rocio, but a city that is happy and knows its citizens by name and is sorry for the rest of Europe. I like Lisbon. It was kind and more than hospitable. I went to the Colliseum and sat by the ringside. My neighbor explained matters carefully in polite French. He accepted a cigarette and commended its flavor. At the end he raised his hat and bowed and bade me a very good night. Imagine him in the Hippodrome, New York! He would have shouldered me warily and explained on the other side the ubiquity of “damn niggers”!</p>
<hr>
<p>Sunset at Funchal in Madeira. The little roar of the little town is softened by the mouth of bells and the curled new moon kisses the electric stars. Above glow the mountains with veils across their misty shoulders—bells, rain and blue sky, green and white homes and the soft laughter of dark eyes—Funchal. With a great circling rainbow day dies. At dawn the fingers of God touch the hills above and they glow with green and gold.</p>
<hr>
<p>The ship is black and white and red. It sails tomorrow and when my feet again touch earth—the earth will be Africa.</p>
<!-- Similar articles start here -->
<div class="clear-wrap">

</div>
<hr>
<section id="related-articles" class="level4">
<h4 class="anchored" data-anchor-id="related-articles">Related Articles:</h4>
<ul>
<li><a href="../../../Volumes/09/01/worldwar.html">World War and the Color Line (1914)</a></li>
<li><a href="../../../Volumes/33/02/travel.html">Travel (1926)</a></li>
<li><a href="../../../Volumes/40/11/panafrica_and_new_racial_philosophy.html">Pan-Africa and New Racial Philosophy (1933)</a></li>
<li><a href="../../../Volumes/18/01/my_mission.html">My Mission (1919)</a></li>
<li><a href="../../../Volumes/28/03/helping_africa.html">Helping Africa (1924)</a></li>
</ul>
<!-- Similar articles end here -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-du_bois1924" class="csl-entry quarto-appendix-citeas" role="listitem">
Du&nbsp;Bois, W.E.B. 1924. <span>“Sketches from Abroad.”</span>
<em>The&nbsp;Crisis</em> 27 (5): 203–95. <a href="https://www.dareyoufight.org/Volumes/27/05/sketches.html">https://www.dareyoufight.org/Volumes/27/05/sketches.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.dareyoufight\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>