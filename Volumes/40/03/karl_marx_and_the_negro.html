<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Du Bois, W.E.B.">
<meta name="dcterms.date" content="1933-03-01">

<title>Karl Marx and the Negro – Dare You Fight</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta name="citation_title" content="Karl Marx and the Negro">
<meta name="citation_author" content="Du Bois, W.E.B.">
<meta name="citation_publication_date" content="1933-03-01">
<meta name="citation_cover_date" content="1933-03-01">
<meta name="citation_year" content="1933">
<meta name="citation_online_date" content="1933-03-01">
<meta name="citation_fulltext_html_url" content="https://www.dareyoufight.org/Volumes/40/03/karl_marx_and_the_negro.html">
<meta name="citation_issue" content="3">
<meta name="citation_volume" content="40">
<meta name="citation_language" content="en">
<meta name="citation_firstpage" content="55">
<meta name="citation_lastpage" content="56">
<meta name="citation_journal_title" content="The Crisis">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Dare You Fight</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../listing.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../covers.html"> 
<span class="menu-text">Covers</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Karl Marx and the Negro</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Du Bois, W.E.B. </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 1, 1933</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Without doubt the greatest figure in the science of modern industry is Karl Marx. He has been a center of violent controversy for three-quarters of a century, and for that reason there are some people who are so afraid of his doctrines that they dare not study the man and his work. This attitude is impossible, and particularly today when the world is so largely turning toward the Marxian philosophy, it is necessary to understand the man and his thought. This little article seeks merely to bring before American Negroes the fact that Karl Marx knew and sympathized with their problem.</p>
<p>Heinrich Karl Marx was a German Jew, born in 1818 and died in 1883. His adult life, therefore, reached from the panic of 1837 through the administration of President Hayes. The thing about him which must be emphasized now was his encyclopedic knowledge. No modern student of industry probably ever equalled his almost unlimited reading and study.</p>
<p>He knew something about American Negroes from his German comrades who migrated to the United States; but these emigrants were of little help so far as his final conclusions were concerned. Kriege, a German radical, who came to the United States, said frankly in 1846, that “We feel constrained to oppose abolition with all our might.” Weitling, a Communist, paid scant attention to the slavery question. The German Labor Convention at Philadelphia in 1850 was dumb on slavery. Even Weidemeyer, Marx’s personal friend, said nothing about slavery in his Workingmen’s League, which was founded in 1853, although the next year he opposed the Kansas-Nebraska Bill. When the League was re-organized in 1857, it still said nothing about slavery, and a powerful branch of the League which seceded in 1857 advocated wide-spread serfdom of blacks and Chinese.</p>
<p>Then came the war and Marx began to give the situation attention.</p>
<blockquote class="blockquote">
<p>The present struggle between the South and the North,” he wrote in 1861, “is … nothing but a struggle between two social systems, the system of slavery and the system of free labor. Because the two systems can no longer live peaceably side by side on the North American continent, the struggle has broken out.”</p>
</blockquote>
<p>He was well acquainted with those splendid leaders of the English workers who kept England from recognizing the South and perhaps entering the Civil War, who employed Frederick Douglass to arouse anti-slavery sentiment, and who organized those monster mass meetings in London and Manchester late in 1862 and early in 1863. It is possible that Marx had some hand in framing the addresses sent to President Lincoln in which they congratulated the Republic and found nothing to condemn except “The Slavery and degradation of men guilty only of a colored skin or African parentage.” The Manchester address congratulated the President on liberating the slaves in the District of Columbia, putting down the slave trade, and recognizing the Republics of Haiti and Liberia, and concluded that “You cannot now stop short of a complete up-rooting of slavery.”</p>
<p>It was after this, in September, 1864, that the International Workingmen’s Association was formed in which Marx was a leading spirit, and his was the pen that wrote the address to Abraham Lincoln in November, 1864.</p>
<blockquote class="blockquote">
To Abraham Lincoln, President of the United States of America.
<p>
Sir: —We congratulate the American peoople upon your re-election by a large majority. If resistance to the Slave Power was the watchword of your first election, the triumphal war-cry of your re-election is Death to Slavery.
</p><p>
From the commencement of the titanic American strife the workingmen of Europe felt distinctively that the Star Spangled Banner carried the destiny of their class. The contest for the territories which opened the <em>dire epopée</em>, was it not to decide whether the virgin soil of immense tracts should be wedded to the labor of the immigrant or be prostituted by the tramp of the slave-driver?
</p><p>
When an oligarchy of 300,000 slaveholders dared to inscribe for the first time in the annals of the world ‘Slavery’ on the banner of armed revolt, when on the very spots where hardly a century ago the idea of one great Democratic Republic had first sprung up, whence the first declaration of the Rights of Man was issued, and the first impulse given to the European Revolution of the eighteenth century, when on those very spots counter-revolution, with systematic thoroughness, gloried in rescinding ‘the ideas entertained at the time of the formation of the old constitution’ and maintained ‘slavery to be a beneficial institution.’ Indeed, the only solution of the great problem of the ‘relation of capital to labor,’ and cynically proclaimed property in man ‘the cornerstone of the new edifice,’—then the working classes of Europe understood at once, even before the fanatic partisanship of the upper classes, for the Confederate gentry had given its dismal warning, that the slaveholders’ rebellion was to sound the tocsin for a general holy war of property against labor, and that for the men of labor, with their hopes for the future, even their past conquests were at stake in that tremendous conflict on the other side of the Atlantic. Everywhere they bore therefore patiently the hardships imposed upon them by the cotton crisis, opposed enthusiastically the pro-slavery intervention-importunities of their betters—and from most parts of Europe contributed their quota of blood to the good of the cause.
</p><p>
While the workingmen, the true political power of the North, allowed slavery to defile their own republic, while before the Negro, mastered and sold without his concurrence, they boasted it the highest prerogative of the white-skinned laborer to sell himself and choose his own master, they were unable to attain the true freedom of labor, or to sup- port their European brethren in their struggle for emancipation; but this barrier to progress has been swept off by the red sen of civil war.
</p><p>
</p><p>The workingmen of Europe felt sure that, as the American War of Independence initiated a new era of ascendency for the middle class, so the American Anti-slavery War will do for the working classes. They consider it an earnest sign of the epoch to come that it fell to the lot of Abraham Lincoln, the single-minded ion of the working class, to lead his country through the matchless struggle for the rescue of the enchained race and the reconstruction of a social world.</p>
</blockquote>
<p>To this the American Ambassador to London replied sympathetically. After Lincoln’s assassination, Marx again drafted a letter, May 13, 1865, in behalf of the International Association.</p>
<blockquote class="blockquote">
The demon of the ‘peculiar institution,’ for whose preservation the South rose in arms, did not permit its devotees to suffer honorable defeat on the open battlefield. What had been conceived in treason, must necessarily end in infamy. As Philip II’s war in behalf of the Inquisition produced a Girard, so Jef- ferson Davis’s rebellion a Booth. …
<p>
</p><p>After a gigantic Civil War which, if we consider its colossal extension and its vast scene of action, seems in comparison with the Hundred Years’ War and the Thirty Years’ War and the Twenty-three Years’ War of the Old World scarcely to have lasted ninety days, the task. Sir, devolves upon you to uproot by law what the sword has felled, and to preside over the more difficult work of political reconstruction and social regeneration. The profound consciousness of your great mission will preserve you from all weakness in the execution of your stern duties. You will never forget that the American people at the inauguration of the new era of the emancipation of labor placed the burden of leadership on the shoulders of two men of labor—Abraham Lincoln the one, and the other Andrew Johnson.</p>
</blockquote>
<p>After the war had closed, in September, 1865, still another letter went to the people of the United States from the same source.</p>
<blockquote class="blockquote">
Again we felicitate you upon the removal of the cause of these years of affliction—upon the abolition of slavery. This stain upon your otherwise, so shining escutcheon is forever wiped out. Never again shall the hammer of the auctioneer announce in your market-places sales of human flesh and blood and make mankind shudder at the cruel barbarism.
<p>
Your noblest blood was shed in washing away these stains, and desolation has spread its black shroud over your country in penance for the past.
</p><p>
Today you are free, purified through your sufferings. A brighter future is dawning upon your republic, proclaiming to the old world that a government of the people and by the people is a government for the people and not for a privileged minority.
</p><p>
We had the honor to express to you our sympathy in your affliction, to send you a word of encouragement in your struggles, and to congratulate you upon your success. Permit us to add a word of counsel for the future.
</p><p>
Injustice against a fraction of your people having been followed by such dire consequences, put an end to it. Declare your fellow citizens from this day forth free and equal, without any reserve. If you refuse them citizens’ rights while you exact from them citizens’ duties, you will sooner or later face a new struggle which will once more drench your country in blood.
</p><p>
The eyes of Europe and of the whole world are on your attempts at reconstruction, and foes are ever ready to sound the death-knell of republican institutions as soon as they see their opportunity.
</p><p>
</p><p>We therefore admonish you, as brothers in a common cause, to sunder all the chains of freedom, and your own victory will be complete.</p>
</blockquote>
<p>In June of that year, a few months after Johnson had become President, Marx, writing to Engels, senses the beginnings of reaction:</p>
<blockquote class="blockquote">
<p>I naturally see what is repulsive in the form of the Yankee movement, hut I find the reason for it in the nature of a bourgeois democracy … where swindle has been on the sovereign throne for so long. Nevertheless, the events are world-upheaving …</p>
</blockquote>
<p>Naturally, Marx stood with the Abolitionist democracy, led by Sumner and Stevens.</p>
<blockquote class="blockquote">
<p>Mr.&nbsp;Wade declared in public meetings that after the abolition of slavery, a radical change in the relation of capital and of property in land is next upon the order of the day.</p>
</blockquote>
<p>He was suspicious of Johnson and wrote Engels in 1865:</p>
<blockquote class="blockquote">
<p>Johnson’s policy disturbs me. Ridiculous affectation of severity against individual persons; up to now highly <em>vacillating</em> and weak in the thing itself. The reaction has already begun in America and will soon be strengthened if this spinelessness is not put an end to.</p>
</blockquote>
<p>And finally, in 1877, after the Negroes had been betrayed by the Northern industrial obligarchy, he wrote:</p>
<blockquote class="blockquote">
<p>The policy of the new president (Hayes) will make the Negroes, and the great exploitation of land in favor of the railways, mining companies, etc. … will make the already dissatisfied farmers, into allies of the working class.</p>
</blockquote>
<p>It was a great loss to American Negroes that the great mind of Marx and his extraordinary insight into industrial conditions could not have been brought to bear at first hand upon the history of the American Negro between 1876 and the World War. Whatever he said and did concerning the uplift of the working class must, therefore, be modified so far as Negroes are concerned by the fact that he had not studied at first hand their peculiar race problem here in America. Nevertheless, He did know the plight of the working class in England, France and Germany, and American Negroes must understand what his panacea was for those folk if they would see their way clearly in the future.</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bois,_w.e.b.1933" class="csl-entry quarto-appendix-citeas" role="listitem">
Bois, W.E.B., Du. 1933. <span>“Karl Marx and the Negro.”</span> <em>The
Crisis</em> 40 (3): 55–56. <a href="https://www.dareyoufight.org/Volumes/40/03/karl_marx_and_the_negro.html">https://www.dareyoufight.org/Volumes/40/03/karl_marx_and_the_negro.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.dareyoufight\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>