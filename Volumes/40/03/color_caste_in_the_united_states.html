<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="W.E.B. Du&nbsp;Bois">
<meta name="dcterms.date" content="1933-03-01">

<title>Color Caste in the United States – Dare You Fight</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta name="citation_title" content="Color Caste in the United States">
<meta name="citation_author" content="W.E.B. Du&nbsp;Bois">
<meta name="citation_publication_date" content="1933-03-01">
<meta name="citation_cover_date" content="1933-03-01">
<meta name="citation_year" content="1933">
<meta name="citation_online_date" content="1933-03-01">
<meta name="citation_fulltext_html_url" content="https://www.dareyoufight.org/Volumes/40/03/color_caste_in_the_united_states.html">
<meta name="citation_issue" content="3">
<meta name="citation_volume" content="40">
<meta name="citation_language" content="en">
<meta name="citation_firstpage" content="59">
<meta name="citation_lastpage" content="60, 70">
<meta name="citation_journal_title" content="The&nbsp;Crisis">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../Images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Dare You Fight</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../listing.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../credits.html"> 
<span class="menu-text">Credits</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../covers.html"> 
<span class="menu-text">Covers</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Color Caste in the United States</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>W.E.B. Du&nbsp;Bois </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 1, 1933</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>There are a large number of well meaning citizens of this country who are under the impression that the main lines of the American Negro problem are settled, and that while there is a deal more advance to be made, nevertheless, the average Negro, who is not too impatient, should be willing from now on to proceed toward his ultimate goal by quiet progress and unemotional appeal.</p>
<p>This is not true. It is so far from the truth that it is probably a fact that if inhabitants of a modern country, like France, England or Germany, who know the meaning of freedom, were subjected to the caste restrictions which surround American Negroes, they would without hesitation burst into flaming revolution.</p>
<p>Let us consider the facts.</p>
<p>We may begin with marriage. A Negro in this country may not, in 26 of the 38 states, marry the person whom he wishes to marry, unless the partner is of Negro descent. Even if he has been married legally elsewhere, he may not in most Southern states live with his wife on pain of fine or imprisonment, unless she is also of Negro descent. A colored girl who is with a child by a white man in the South has no legal way of making her child legitimate, and in most Southern states and many Northern could get no standing in court. The very fact of having Negro blood is regarded in most Southern states as being such a stigma that the false allegation of it may be basis of an action for damages.</p>
<p>The Negro married couple may not live where they wish or in a home that they are able to buy. By law or custom, covenant or contract, or by mob violence, they are everywhere in the United States restricted in their right of domicile and for the most part must live in the worst parts of the city, and on the poorest land in the country; their sections receive from the local government the least attention and they are peculiarly exposed to crime and disease.</p>
<p>Negroes are especially restricted in the chance to earn a living. If they are farmers in the South, the quality and situation of the land they can buy, their access to market, their freedom to plant and do business is seriously curtailed. They cannot in the South take part in co-operative farming or farmers’ organizations, except in organizations which are composed entirely of Negroes. They are restricted and systematically cheated in the selling of their crop. They have little chance for the education of their children and they have no voice in their own government and taxation, and over wide areas in Louisiana, Mississippi, Alabama and Georgia Negro farm labor is held in actual peonage.</p>
<p>In general, Negroes are “segregated,” which means that their normal, social development in all lines is narrowed, curtailed or stopped. They cannot develop as a separate group without police power and inner social sanctions, economic protection and the power of public opinion. Where, for instance, schools are separated by race, the colored race has no power to select teachers, choose text books or administer its own schools, nor does it have voice in spending the school funds. It cannot develop as a part of the larger group because the developing and differentiating individual who by ability, education, wealth or character seeks to rise from the average level of weakness, ignorance, poverty, and delinquency of his group is clubbed back by the color bar and condemned to submersion or fruitless revolt.</p>
<p>This is especially illustrated in the Negroes’ efforts to earn a living. In manufacturing, business and industry, they cannot get capital to carry on enterprises unless they raise it in small sums from their own poverty. In case they do, their small capital, their inability to gain practical experience by contact, and their lack of credit dooms them from the start. In trade, Negroes are greatly restricted. Their small banks are entirely at the mercy of the big credit organizations. The retail stores stand little chance in competition with the chain stores, and in the chain stores for the most part no Negroes are hired as managers and few as clerks. In insurance, their opportunity is restricted by the white state insurance officials and by limited knowledge and opportunity for investment of funds.</p>
<p>Negroes forming one-tenth of the population own but 1/140 per cent of the wealth. Their per capita wealth is $215 as compared with over $3,000 for the average American. They can command certainly not more than 1/10,000 of current bank credit.</p>
<p>If they learn mechanical trades they are restricted by the unions, most of which either by actual legislation or by vote of local unions will not allow them to join. If they do not join the Union, they only get a chance to work as scabs, in which case they are in danger of mob violence by their fellow workers and of a widespread propaganda which represents them as scabbing by choice or ignorance. If they attempt to form their own unions, they can seldom find enough Negroes in a given locality skilled to take over whole units of work. Negroes must, therefore, compete mostly for unskilled and semi-skilled labor below the current rate of wages. They cannot expect promotion. They have, therefore, no voice in the conduct of industry, and are liable to dismissal with the least consideration of any workers. Particularly, when it comes to new kinds of work and new machines and new methods, they are the last to be given an opportunity to learn and they are admitted to a minimum of wage and consideration.</p>
<p>In transportation, they can only work as common laborers and porters. The railway unions of engineers, conductors and firemen by constitutional enactment will not admit them. There is a colored Firemen’s Union but it has been fought in every way by the white firemen, who in the last few years have resorted to open murder. The union of Pullman Porters is excluded from the effective councils of the American Federation of Labor.</p>
<p>In public and civil service they are especially restricted, even under Civil Service rules. The United States Civil Service Commission requires the filing of a photograph with each application which makes and was designed to make the systematic exclusion of successful Negro applicants easier. Government trade-unions, like the postal clerks, segregate Negroes and thus disfranchise them in negotiations. In state, city and county civil service a few Negroes get in in the North; but in all the states of the Southern South any black man, whether he can read or write, or owns property, or whatever his qualifications, can be kept from effectively exercising the right to vote. In those Southern States where eight of the twelve million Negroes live there is not a single Negro member of the legislature, not a single Negro who holds a county office, not a single member of a city council, and of the 1,700 Southern cities and towns of 1,000 and more inhabitants, not 50 have a single Negro policeman. Negroes are thus taxed without representation and receive scant consideration from the officers of the administration.</p>
<p>On the stage and in literature and art, the Negro has some opportunity but his genius is limited by a public who will not endure any portrayal of a Negro save as a fun-maker, a moron or criminal. There have been some few exceptions to this but they emphasize the rule. Neither Paul Robeson nor Jules Bledsoe was allowed to sing the title role in “Emperor Jones” at the Metropolitan Opera; it was given to a white man blacked-up. Colored artists and writers who portray what they wish and feel and know get but a restricted and cool white audience and their colored audience is not only limited by poverty and ignorance, but its enlightened elements get their standards of judgment indirectly from the whites.</p>
<p>The Negro is forced into crime. His lawyers stand small opportunity in the courts of the South and restricted opportunity in the North. For the most part, the Negro is arrested by an ignorant, prejudiced and venal white policeman and his mere arrest usually means conviction. He gets little to no legal defense, and even if innocent, is apt to receive the “limit of the law.” His crime in the South is traded in so that many states actually make a surplus income by selling the work of criminals to private profiteers, The courts for years in the South have been made instruments for reducing the Negro to peonage and slavery. Any attempt to measure the real amount of Negro crime by counting the persons arrested and convicted is nonsense, and the treatment of Negroes in confinement can be read in Spivak’s “Georgia N⸺.”</p>
<p>In the professions, law, medicine and the ministry, the Negro must serve mainly his own race; for this reason, he is tempted or compelled to get cheaper or poorer preparation, to lack contact with the best and newest thought and method, to receive lower compensation and even if he surmounts these obstacles, to have his skill discounted and his opportunity curtailed on account of race.</p>
<p>There are (1926) in the United States, 232,154 churches, of which 42,585 are confined to Negroes, This leaves 189,569 white churches. Of at least 175,000 of these, no Negro can be a member. There are 5,535 Y.M.C.A. and Y.W.C.A. organizations, of which 200 are for Negroes. No Negro can join at least 5,000 of the other associations,</p>
<p>In domestic and personal service, the lower the grade of work, the more unprotected the women and children are, the larger opportunity is given to Negroes. Wherever the service is standardized and given a decent wage as in most first class hotels they are excluded.</p>
<p>The opportunity of the Negro for education is limited. In the sixteen former slave states in 1930, over a million Negro children of school age were not in school a single day in the year; and half the Negro children are not in regular attendance. Southern Negro children, forming a third of the school population, received 1/10 of the school funds, and the million and a half who attended school had an average term of only six months.</p>
<p>In the mixed schools of the North, colored children are often neglected and discouraged and if they are migrants from the South, suffer retardation because of lack of educational opportunity in early years.</p>
<p>The little money which the Negro earns is spent under equally difficult circumstances. In the South, he cannot travel without the insult of separate and inferior cars, for which he pays the standard price. On many express trains he cannot travel at all. In Texas, Oklahoma and Arkansas he cannot use a sleeping car at all and in other Southern States he can hire a berth only under humiliating difficulties. In Southern railway stations he must often use side entrances. He cannot take recreation in public parks and museums, or in public buildings, at public lectures, concerts and entertainments, He is not admitted to public competitions on equal terms. He can attend most Northern colleges, but cannot instruct or teach or take advantage of scientific foundations, so that the whole field of graduate training and scientific research is thus seriously narrowed for him.</p>
<p>He lives under a stigma which is increased by deliberate propaganda: by the teaching of professors and school teachers, by the words of textbooks, by the distorted message of history, and by the deliberate misinterpretation of science. And above all, it is practically impossible for any Negro in the United States, no matter how small his heritage of Negro blood may be, to meet his fellow citizens on terms of social equality without being made the subject of all sorts of discriminations, embarassments and insults. Finally, the persons thus called and treated and measured as “Negroes” may be predominantly of Nordic blood with perhaps one Negro great-great grandparent in 16.</p>
<p>It would be untrue to say that all these restrictions happen to all Negroes at all times. There are innumerable exceptions, personal and geographical. Nevertheless, by and large, this is a true picture of the caste situation in the United States today. On the other hand, those people who insist that color discrimination has decreased are right. There was a time 100 years ago, when a Negro had no rights which a white man was bound to respect. Even 50 years ago, a white man had a right to knock a Negro down for any offense, real or fancied and walk away without danger or arrest. In certain districts of Mississippi, Alabama, Louisiana, Georgia and Texas this is still true. In every Southern state and in some Northern states, the case of a white man who kills a Negro and is punished for it is regarded by the newspapers as unusual news. Today, in any altercation between a white and black man the burden of proof is on the black man and the chances of his getting the worst of it at the hands of the law are ten times as great as those of the white man.</p>
<p>This, then, is the situation, and the question is, what are modern, educated people going to do about, whether they are white or black?</p>
<!-- Similar articles start here -->
<hr>
<section id="related-articles" class="level4">
<h4 class="anchored" data-anchor-id="related-articles">Related Articles:</h4>
<ul>
<li><a href="../../../Volumes/36/05/negro_citizen.html">The Negro Citizen (1929)</a></li>
<li><a href="../../../Volumes/05/04/intermarriage.html">Intermarriage (1913)</a></li>
<li><a href="../../../Volumes/31/05/correspondence.html">Correspondence (1926)</a></li>
<li><a href="../../../Volumes/40/11/panafrica_and_new_racial_philosophy.html">Pan-Africa and New Racial Philosophy (1933)</a></li>
<li><a href="../../../Volumes/14/02/resolutions.html">Resolutions of the Washington Conference (1917)</a></li>
</ul>
<!-- Similar articles end here -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-du_bois1933" class="csl-entry quarto-appendix-citeas" role="listitem">
Du&nbsp;Bois, W.E.B. 1933. <span>“Color Caste in the United States.”</span>
<em>The&nbsp;Crisis</em> 40 (3): 59–60, 70. <a href="https://www.dareyoufight.org/Volumes/40/03/color_caste_in_the_united_states.html">https://www.dareyoufight.org/Volumes/40/03/color_caste_in_the_united_states.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.dareyoufight\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>