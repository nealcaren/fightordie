<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="W.E.B. Du&nbsp;Bois">
<meta name="dcterms.date" content="1913-04-01">

<title>The Princess of the Hither Isles – Dare You Fight</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta name="citation_title" content="The Princess of the Hither Isles">
<meta name="citation_author" content="W.E.B. Du&nbsp;Bois">
<meta name="citation_publication_date" content="1913-04-01">
<meta name="citation_cover_date" content="1913-04-01">
<meta name="citation_year" content="1913">
<meta name="citation_online_date" content="1913-04-01">
<meta name="citation_fulltext_html_url" content="https://www.dareyoufight.org/Volumes/06/06/princess_of_hither_isles.html">
<meta name="citation_issue" content="6">
<meta name="citation_volume" content="6">
<meta name="citation_language" content="en">
<meta name="citation_firstpage" content="285">
<meta name="citation_lastpage" content="289">
<meta name="citation_journal_title" content="The&nbsp;Crisis">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../Images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Dare You Fight</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../listing.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../backround.html"> 
<span class="menu-text">Background</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="../../../map.html">
 <span class="dropdown-text">Article Map</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../covers.html">
 <span class="dropdown-text">Covers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../credits.html">
 <span class="dropdown-text">Credits</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Princess of the Hither Isles</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>W.E.B. Du&nbsp;Bois </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 1, 1913</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Her soul was very beautiful, wherefore she kept it veiled in lightly laced Humility, and Fear, out of which peered anxiously ever and anon the white and blue and pale gold of her face — beautiful as daybreak or as the laughing of a child. She sat in the Hither Isles, well walled between the This and Now, upon a low and silver throne and leaned upon its armposts sadly looking upward toward the sun. Now the Hither Isles are flat and cold and swampy, with drear drab light and all manner of slimy, creeping things, and piles of dirt and clouds of flying dust and sordid scraping and feeding and noise.</p>
<p>She hated them; and ever as her hands and busy feet swept back the dust and slime, her soul sat silent, silver throned, staring toward the great hill to westward, which shone so brilliant golden beneath the sunlight and above the sea.</p>
<p>The sea moaned and with it moaned the Princess’ soul, for she was lonely; very, very lonely, and full weary of the monotone of life. So she was glad to see a moving in Yonder Kingdom on the mountain side where the sun shone warm, and when the King of Yonder Kingdom, silken in robe and golden crowned, warded by his hound, walked down along the restless waters and sat beside the armpost of her throne, she wondered why she could not love him and fly with him up the shining mountain’s side out of the dirt and dust that nested between This and Now. She looked at him and tried to be glad, for he was bonny and good to look upon, this King of Yonder Kingdom: tall and straight, thin lipped and white and tawny. So again this last day she strove to burn life into his singularly sodden clay — to put his icy soul aflame wherewith to warm her own, to set his senses singing. Vacantly he heard her winged words, staring and curling his long mustaches with vast thoughtfulness. Then he said:</p>
<p>“We’ve found more gold in Yonder Kingdom.”</p>
<p>“Hell seize your gold!” blurted the Princess.</p>
<p>“No — it’s mine,” he maintained stolidly.</p>
<p>She raised her eyes. “It belongs,” she said, “to the Empire of the Sun.”</p>
<p>“Nay — the sun belongs to us,” said the King calmly, as he glanced to where Yonder Kingdom blushed above the sea. She glanced, too, and a softness crept into her eyes.</p>
<p>“No, no,” she murmured, as with hesitating pause she raised her eyes above the sea, above the hill, up into the sky where the sun hung silent, splendid. Its robes were heaven’s blue, lined and broidered in living flame, and its crown was one vast jewel glistening in glittering glorv that made, the sun’s own face a blackness — the blackness of utter light. With blinded, tear-filled eyes she peered into that formless black and burning face and sensed in its soft, sad gleam unfathomed understanding. With sudden wild abandon she stretched her arms toward it appealing, beseeching, entreating, and lo!</p>
<p>“Niggers and dagoes,” said the King of Yonder Kingdom, glancing carelessly backward and lighting in his lips a carefully rolled wisp of fragrant tobacco. She looked back, too, but in halfwondering terror, for it seemed —</p>
<p>A Beggar man was creeping across the swamp, shuffling through the dirt and slime. He was little and bald and black, rough clothed, sooted with dirt and bent with toil. Yet withal something she sensed about him, and it seemed —</p>
<p>The King of Yonder Kingdom lounged more comfortably beside the silver throne and let curl a tiny trail of light blue smoke.</p>
<p>“I hate Beggars,” he said, “especially brown and black ones.” And he then pointed at the Beggar’s retinue and laughed — an unpleasant laugh welded of contempt and amusement. The Princess looked and shrank on her throne. He the Beggar man was — was what? But his retinue, that squalid, sordid particolored band of vacant, dull-faced filth and viciousness, was writhing over the land, and he and they seemed almost crouching underneath the scorpion lash of one tall skeleton that looked like Death, and the twisted woman whom men call Pain. Yet they all walked as One.</p>
<p>The King of Yonder Kingdom laughed, but the Princess shrank on her throne and the King seeing her took a gold piece from out his purse and tossed it carelessly to the passing throng. She watched it with fascinated eyes—how it rose and sailed and whirled and struggled in the air; then seemed to burst, and upward flew its sunlight and its sheen and downward dropped its dross. She glanced at the King, but he was lighting a match. She watched the dross wallow in the slime, but the sunlight fell on the back of the Beggar’s neck and he turned his head.</p>
<p>The Beggar, passing afar, turned his head, and the Princess straightened on her throne; he turned his head, and she shivered forward on her silver seat; he looked upon her full and slow and suddenly she saw within that formless black and burning face the same soft, sad gleam of utter understanding seen so many times before. She saw the suffering of endless years and endless love that softened it. She saw the burning passion of the sun and with it the cold unbending duty-deeds of upper air. All she had seen and dreamed of seeing in the rising, blazing sun she saw now again, and with it myriads more of human tenderness, of longing and of love. So then she knew. So then she rose as to a dream come true with solemn face and waiting eyes.</p>
<p>With her rose the King of Yonder Kingdom, almost eagerly.</p>
<p>“You’ll come?” he cried. “You’ll come and see my gold?” And then in sudden generosity he added: “You’ll have a golden throne—up there, when we marry.”</p>
<p>But she, looking up and on with radiant face, answered softly: “I come.”</p>
<p>So down and up and on they mounted; the black Beggar and his cavalcade of Death and Pain, and then a space; and then a lone black hound that nosed and whimpered as he ran, and then a space; and then the King of Yonder Kingdom in his robes, and then a space; and last the Princess of the Hither Isles, with face set sunward and lovelight in her eyes.</p>
<p>And so they marched and struggled on and up through endless years and spaces, and ever the black Beggar looked back past Death and Pain toward the maid, and ever the maid strove forward with lovelit eyes, but ever the great and silken shoulders of the King of Yonder Kingdom rose between the Princess and the sun like a cloud of storms.</p>
<p>Now finally they neared unto the hillside’s topmost shoulder, and there most eagerly the King bent to the bowels of the earth and bared its golden entrails — all green and gray and rusted — while the Princess strained her pitiful eyes aloft to where the Beggar, set ’twixt Death and Pain, whirled his slim back against the glory of the setting sun and stood, sombre in his grave majesty, enhaloed and transfigured, outstretching his long arms; and, around all Heaven, glittered jewels in a cloth of gold.</p>
<p>A while the Princess stood and moaned in mad amaze, then with one wilful wrench she bared the white flowers of her breast and snatching forth her own red heart held it with one hand aloft while with the other she gathered close her robe and poised herself.</p>
<p>The King of Yonder Kingdom looked upward quickly, curiously, still fingering the earth, and saw the offer of her bleeding heart.</p>
<p>“It’s a Nigger,” he growled darkly; “it may not be.”</p>
<p>The woman quivered.</p>
<p>“It’s a Nigger,” he repeated fiercely. “It’s neither God nor Man. but a Nigger.”</p>
<p>The Princess stepped forward.</p>
<p>The King grasped his great sword and looked north and east; he raised his long sword and looked south and west.</p>
<p>“I seek the sun,” the Princess sang, and started into the west.</p>
<p>“Never!” cried the King of Yonder Kingdom, “for such were blasphemy and defilement and the making of all evil.”</p>
<p>So raising his great sword he struck with all his might and more. Down hissed the blow and bit that little white heart-holding hand till it flew armless and disbodied up through the sunlit air. Down hissed the blow and clove the whimpering hound till his last shriek shook the stars. Down hissed the blow and rent the earth. It trembled, fell apart and yawned to a chasm wide as earth from Heaven, deep as hell, and empty, cold and silent.</p>
<p>On yonder distant shore blazed the mighty Empire of the Sun in warm and blissful radiance; while on this side, in shadows cold and dark, gloomed the Hither Isles and the hill that once was golden but now was green and slimy dross; all below was the sad and moaning sea, while between the Here and There flew the severed hand and dripped the bleeding heart.</p>
<p>Then up from the soul of the Princess welled a cry of dark Despair — such cry as only babe-raped mothers know, and murdered loves. Poised on the crumbling edge of that great nothingness the Princess hung, hungering with her eyes and straining her fainting ears against the awful splendor of the sky.</p>
<p>Out from the slime and shadows groped the King, thundering; “Back — don’t be a fool!”</p>
<p>But down through the thin ether thrilled the still and throbbing warmth of heaven’s sun whispering “Leap!”</p>
<p>And the Princess leapt.</p>
<!-- Similar articles start here -->
<div class="clear-wrap">

</div>
<hr>
<section id="related-articles" class="level4">
<h4 class="anchored" data-anchor-id="related-articles">Related Articles:</h4>
<ul>
<li><a href="../../../Volumes/03/06/in-gods-gardens.html">In God’s Gardens (1912)</a></li>
<li><a href="../../../Volumes/03/01/quadroon.html">The Quadroon (1911)</a></li>
<li><a href="../../../Volumes/09/01/burden_of_black_women.html">The Burden of Black Women (1914)</a></li>
<li><a href="../../../Volumes/19/02/gospel.html">The Gospel According to Mary Brown (1919)</a></li>
<li><a href="../../../Volumes/03/03/mild_suggestion.html">A Mild Suggestion (1912)</a></li>
</ul>
<!-- Similar articles end here -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-du_bois1913" class="csl-entry quarto-appendix-citeas" role="listitem">
Du&nbsp;Bois, W.E.B. 1913. <span>“The Princess of the Hither Isles.”</span>
<em>The&nbsp;Crisis</em> 6 (6): 285–89. <a href="https://www.dareyoufight.org/Volumes/06/06/princess_of_hither_isles.html">https://www.dareyoufight.org/Volumes/06/06/princess_of_hither_isles.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.dareyoufight\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>