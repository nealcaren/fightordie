<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="W.E.B. Du Bois">
<meta name="dcterms.date" content="1923-02-01">

<title>The Tragedy of ‘Jim Crow’ – Dare You Fight</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta name="citation_title" content="The Tragedy of &amp;amp;#039;Jim Crow'">
<meta name="citation_author" content="W.E.B. Du Bois">
<meta name="citation_publication_date" content="1923-02-01">
<meta name="citation_cover_date" content="1923-02-01">
<meta name="citation_year" content="1923">
<meta name="citation_online_date" content="1923-02-01">
<meta name="citation_fulltext_html_url" content="https://www.dareyoufight.org/Volumes/26/04/tradgedy_of_jim_crow.html">
<meta name="citation_issue" content="4">
<meta name="citation_volume" content="26">
<meta name="citation_language" content="en">
<meta name="citation_firstpage" content="169">
<meta name="citation_lastpage" content="172">
<meta name="citation_journal_title" content="The Crisis">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../Images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Dare You Fight</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../listing.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../covers.html"> 
<span class="menu-text">Covers</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Tragedy of ‘Jim Crow’</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>W.E.B. Du Bois </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 1, 1923</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>There is developing within the Negro race a situation bordering on tragedy in regard to the “Jim Crow” movement now growing and spreading in the North. The tragedy has been with us before but it has been more or less dormant and unspoken. To-day it is flaring to red flame and we must sit down and reason together.</p>
<p style="text-align:center">
~~~~~~~~~~~~~~~
</p>
<p>I stood yesterday before three thousand folk in Philadelphia and said at length what I am saying now more concisely and definitely. It was an earnest crowd quivering with excitement and feeling, and the thing that it had in mind was this:</p>
<p>For 90 years, Pennsylvania has had a private colored school founded by Richard Humphreys, a West Indian ex-slave-holder. The institute was located first on Lombard Street, Philadelphia, then on Bainbridge Street and finally in 1911 was removed to Cheyney, twenty miles from Philadelphia in a beautiful section where new buildings were erected and a normal school equipped.</p>
<p>Many distinguished persons have been at the head of the school including Charles L. Reason of New York, Ebenezer D. Bassett, afterward Minister to Haiti, the late Fannie Jackson Coppin, Hugh Brown and at present Leslie P. Hill, Harvard ’03, Phi Beta Kappa. In 1914, the school began to receive State aid at the rate of $6,000 every two years. In 1920, the school was made a State Normal School with an appropriation of $125,000 per year for two years.</p>
<p>Meantime the Northern states slowly struggled out from the shadow of “Jim Crow” school legislation. The schools of New York City became mixed and Negro teachers were appointed who taught without segregation. The same thing happened in Massachusetts, in Northern Illinois and Northern Ohio; in Pennsylvania it became in 1881, “unlawful” to make “any distinction whatever” on account of race among public school children.</p>
<p>Notwithstanding this, separate Negro schools with Negro teachers in Northern states continued to exist. For some time they declined in number; then came the growing concentration of Negroes in cities and finally the new Negro migration from the South. This meant quiet but persistent and renewed attempts at school segregation. The number of separate schools increased in the North, and in Kansas segregation was legalized by permissive legislature.</p>
In Philadelphia particularly separation was carried far by administrative action despite the law, so that to-day while the high school and 200 common schools have colored and white pupils, there are eleven schools with Negro pupils alone, and colored teachers are appointed only in those schools. Thus segregated schools are on the increase in the North and there is no doubt but what we shall see a larger and larger number of them as the flood tide of Southern Negro migration increases.
<p style="text-align:center">
~~~~~~~~~~~~~~~
</p>
<p>What shall be our attitude toward this segregation? The National Association for the Advancement of Colored People together with its organ, <span class="small-caps">The Crisis</span>, and all thinking men, white and black, have long since taken strong ground against compulsory racial segregation of any sort. This has been true from the foundation of the Association; and we have especially insisted that of all the sorts of segregation and discrimination that meet the Negroes in the United States, that in the common public schools is most dangerous, most insidious, the most far reaching.</p>
<p>Education in the public schools by races or by classes means the perpetuation of race and class feeling throughout the land. It means the establishment of group hostility in those tender years of development when prejudices tend to become “natural” and “instinctive.” It is the plain duty of all true Americans who believe in democracy and broad human development to oppose this spread of segregation in the public schools.</p>
<p style="text-align:center">
~~~~~~~~~~~~~~~
</p>
<p>On the other hand we are to-day, as practical thinkers and workers, faced by the grim fact of a school segregation already in being: of public common schools, private common schools, high schools and colleges attended exclusively by Negroes and manned wholly and largely by Negroes. Our educational plight is still precarious; but without the self-sacrificing efficient colored teacher of colored youth to-day, we would face positive disaster. These teachers have in their ranks some of the finest trained men and women in the world and the black race can never repay them for the work they have done under difficulty and deprivation, obloquy and insult, and sometimes even with the hatred and abuse of colored folk themselves.</p>
<p>Here then we face the amazing paradox: we must oppose segregation in schools; we must honor and appreciate the colored teacher in the colored school.</p>
<p>How can we follow this almost self-contradictory program? Small wonder that Negro communities have been torn in sunder by deep and passionate differences of opinion arising from this pitiable dilemma.</p>
<p style="text-align:center">
~~~~~~~~~~~~~~~
</p>
<p>Despite all theory and almost unconsciously we are groping on. We recognize one thing worse than segregation and that is ignorance. There is, for instance, among the Negroes of the United States no effort to disestablish the separate public schools of the South. Why? They are wrong; they are undemocratic; they are ridiculously and fatally costly; they mean inferior schools for colored people, discrimination in equipment and curriculum; and yet so long as the race feeling is what it is in the South, mixed schools are utterly impossible. Even if by law we could force colored children into the white schools, they would not be educated. They would be abused, browbeaten, murdered, kept in something worse than ignorance. What is true in the South is true in most parts of the border states and in some parts of the North. In some of these regions where there are mixed schools, innocent colored children of tender years are mercilessly mistreated and discriminated against and practically forced out of school before they have finished the primary grades. Even in many of the best Northern states colored pupils while admitted and treated fairly, receive no inspiration or encouragement.</p>
<p>How else can we explain the astonishing fact that with practically the same kinds of colored population in cities like Washington, Baltimore, Philadelphia and New York, the 200,000 Negroes in Washington and Baltimore send out 400 colored High School graduates every year, while 250,000 Negroes in Philadelphia and New York send out only 50? Moreover the academic standards of these colored High Schools have been proven to be fairly high by the success of their graduates in Northern colleges. What are we going to do about this? First and foremost and more important than anything else, Negro children must not be allowed to grow up in ignorance. This is worse than segregation, worse than anything we could contemplate.</p>
<p>There is only one method to avoid both this and segregation and that is by efforts such as are being made in New York City. The movement is still young and wavering, but it is a beginning. We are trying there to superintend the course of colored children in the mixed public school. We are seeking to guide them there and to help them at home; we try to discover and oppose prejudiced teachers; we encourage their enrollment in High Schools. There is no reason why a movement like this, pushed with unwavering determination, should not succeed in bringing the High School enrollment of black New York up to the level of Washington, Baltimore and St.&nbsp;Louis.</p>
<p style="text-align:center">
~~~~~~~~~~~~~~~
</p>
<p>In Philadelphia no such movement is manifest. On the contrary with the colored citizens largely asleep for a long time, the solution of separate colored schools has been accepted with only half-hearted protest. To-day, however, strangely enough protest has risen to fever heat, and why? Because two years ago, Cheyney was made a colored State Normal School. We say colored advisedly because there is no use of stickling at facts or dodging behind legal quibbles. Cheyney is to-day a State Normal School for Negroes. Is this a fault, and if so whose fault is it? A large number of honest and earnest colored people in Philadelphia—persons who have cooperated with this Association and who believe in its work and possibilities, have taken this stand:</p>
<ol type="1">
<li>There is a conspiracy in Philadelphia to segregate all colored teacher training of the state in Cheyney, where with inferior equipment, colored teachers will be educated and sent out for use in a growing system of segregated colored public schools.</li>
<li>That Leslie Hill and his teachers are at least in part responsible for the programme and have aided and abetted it.</li>
</ol>
<p>Without a shadow of a doubt many white people of Pennsylvania have the programme above in mind; without doubt principals of many of the other thirteen Normal Schools and some public school officials would welcome and push to the limit of the law and past it, the segregation of colored teachers and pupils; but there is no proof that all white folk in authority want this; there is no proof that the state does not intend to make Cheyney the equal of any other State Normal School; moreover according to present law no Negro is compelled to attend Cheyney. All of the other 13 normal schools of the State remain absolutely open to those who wish to attend them. And above all, proof is absolutely lacking that Hill and his teachers are dishonest betrayers of the interests of their race.</p>
<p>Leslie Hill and his wife Jane Hill have had honorable and self-sacrificing records. He has surrounded himself by the best faculty his limited funds would allow: Harvard, Radcliffe, the University of London and similar schools have trained them. I have seen schools in two continents and ten countries and I have yet to see a finer group in character and service than the teachers of Cheyney. And yet for three months these people were actually deprived of bread and butter by legal injunctions and pursued by denunciation, ostracism and innuendo, while the real culprits, the white “Jim Crow” officials, publicists and philanthropists stood aside unscathed and smiling to see the “darkies” quarrel.</p>
<p style="text-align:center">
~~~~~~~~~~~~~~~
</p>
<p>I am not for a moment calling in question the motives and sincerity of those in Philadelphia who are fighting segregation. In such a fight I am with them heart and soul. But when this fight becomes a fight against Negro school teachers I quit. I believe in Negro school teachers. I would to God white children as well as colored could have more of them. With proper training they are the finest teachers in the world because they have suffered and endured and nothing human is beneath their sympathy.</p>
<p style="text-align:center">
~~~~~~~~~~~~~~~
</p>
<p>I know perfectly well that there have been colored educators and leaders who in order to get funds for their schools and enterprises and positions for their friends and children have betrayed and sold out the interests of their race and humanity. I have denounced and will denounce such men unsparingly. But it does not follow that when a black man makes a black enterprise the best and most efficient for its purpose that he is necessarily a traitor or that he believes in segregation by race. A condition, not a theory confronts him. It was the duty of Hill to make Cheyney a school. He did not found Cheyney. It was founded half a century before he was born. He did try and is trying to raise it from the status of a second class High School without funds, equipment or recognition, to one of the best normal schools of one of the greatest states of the Union. Those folk, white or black, who seek to saddle this programme with a permanent “Jim Crow” school policy in the commonwealth of William Penn deserve the damning of every decent American citizen; and those folk are not black folk—they are white and wealthy and powerful, and many of them are distinguished Quakers.</p>
<p>The real fight in Philadelphia and Pennsylvania should be made on the following lines:</p>
<ol type="1">
<li>To stop by agitation, political power, and legal method, all further increase of public common schools segregated by race. The appointment and election of openly sympathetic school officials is the first step in this campaign</li>
<li>To continue to insist on the appointment of colored teachers in white schools</li>
<li>To support the efforts to make the present segregated schools the very best possible and to open them to white children</li>
<li>To make Cheyney the best Normal School in the state and to encourage the entry of white students</li>
<li>To see to it by scholarships and local efforts that colored pupils are kept in every other normal school of the state</li>
<li>To make the colored teacher feel that no calling is so fine and valuable as his and that the Negro race and the world knows it.</li>
</ol>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-du_bois1923" class="csl-entry quarto-appendix-citeas" role="listitem">
Du Bois, W.E.B. 1923. <span>“The Tragedy of <span>‘Jim
Crow’</span>.”</span> <em>The Crisis</em> 26 (4): 169–72. <a href="https://www.dareyoufight.org/Volumes/26/04/tradgedy_of_jim_crow.html">https://www.dareyoufight.org/Volumes/26/04/tradgedy_of_jim_crow.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.dareyoufight\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>